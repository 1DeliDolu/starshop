# âš™ï¸ Part Entity / ParÃ§a VarlÄ±ÄŸÄ±

Ana sayfada `Starship` varlÄ±ÄŸÄ±mÄ±z sayesinde zaten uzay gemileri gÃ¶steriliyor. Ama artÄ±k bir adÄ±m ileri gitme zamanÄ±. Her `Starship`te kullanÄ±lan bireysel parÃ§alarÄ± takip etmemiz gerekiyor. Plan ÅŸÃ¶yle: her parÃ§a yalnÄ±zca bir `Starship`e ait olacak ve her `Starship` birÃ§ok parÃ§aya sahip olacak. Ancak iliÅŸkilere geÃ§meden Ã¶nce, basit baÅŸlamalÄ±yÄ±z: bu parÃ§alarÄ± takip edecek yeni bir `entity`'ye ihtiyacÄ±mÄ±z var! Terminali aÃ§Ä±n, yeni bir sekme oluÅŸturun (Ã§Ã¼nkÃ¼ sunucumuz hÃ¢lÃ¢ Ã§alÄ±ÅŸÄ±yor) ve ÅŸu komutu Ã§alÄ±ÅŸtÄ±rÄ±n:

```shell
symfony console make:entity
```

ğŸ‘‰ Bu komut, yeni bir `entity` oluÅŸturmak iÃ§in etkileÅŸimli bir sihirbaz baÅŸlatÄ±r.

AdÄ±nÄ± `StarshipPart` koyun, `broadcasting` adÄ±mÄ±nÄ± atlayÄ±n ve birkaÃ§ alan ekleyin: `name` bir `string` olacak ve `nullable` olmayacak, `price` bir `integer` olacak (kredi cinsinden elbette) ve o da `nullable` olmayacak. Son olarak, `notes` alanÄ± `text` tÃ¼rÃ¼nde olacak (daha uzun metinler iÃ§in) ve `nullable` olacaktÄ±r. Bu alanlarÄ± ekledikten sonra, ÅŸu komutla yeni bir `migration` oluÅŸturun:

```shell
symfony console make:migration
```

ğŸ‘‰ Bu komut, yeni tanÄ±mlanan `entity` iÃ§in veritabanÄ± geÃ§iÅŸi (migration) dosyasÄ± oluÅŸturur.

## Running Migrations and Adding Timestamps / GeÃ§iÅŸleri Ã‡alÄ±ÅŸtÄ±rmak ve Zaman DamgalarÄ± Eklemek

ArtÄ±k `migration`lara bakarsanÄ±z, sadece yeni oluÅŸturduÄŸumuz dosyayÄ± gÃ¶rÃ¼rsÃ¼nÃ¼z: Ã¶nceki dersteki eski migrationâ€™larÄ± temizledim.

```php
//migrations/Version20250801065720.php

// ... lines 1 - 12
final class Version20250306155858 extends AbstractMigration
{
// ... lines 15 - 19
    public function up(Schema $schema): void
    {
        // this up() migration is auto-generated, please modify it to your needs
        $this->addSql('CREATE TABLE starship_part (id INT GENERATED BY DEFAULT AS IDENTITY NOT NULL, name VARCHAR(255) NOT NULL, price INT NOT NULL, notes TEXT DEFAULT NULL, PRIMARY KEY(id))');
    }
// ... lines 25 - 30
}
```

ğŸ‘‰ Bu kod, `starship_part` adÄ±nda bir tabloyu veritabanÄ±nda oluÅŸturur.

Åimdi bunu Ã§alÄ±ÅŸtÄ±rÄ±n:

```shell
symfony console doctrine:migrations:migrate
```

ğŸ‘‰ Bu komut, tÃ¼m `migration`larÄ± veritabanÄ±na uygular.

VeritabanÄ± tablosu hazÄ±r! Ancak tÃ¼m `entity`lerime eklemeyi sevdiÄŸim iki alan daha var: `createdAt` ve `updatedAt`. BunlarÄ± `Starship` iÃ§erisinde, `TimestampableEntity` iÃ§inde gÃ¶rebilirsiniz.

```php
// src/Entity/Starship.php
use Gedmo\Timestampable\Traits\TimestampableEntity;
// ... lines 1 - 11
class Starship
{
    use TimestampableEntity;
// ... lines 15 - 137
}
```

ğŸ‘‰ Bu `trait`, `createdAt` ve `updatedAt` alanlarÄ±nÄ± otomatik olarak ayarlar.

AynÄ±sÄ±nÄ± alÄ±p `StarshipPart`'Ä±n en Ã¼stÃ¼ne yapÄ±ÅŸtÄ±rÄ±n. Bu iki Ã¶zellik, Ã¶nceki derste yÃ¼klediÄŸimiz bir kÃ¼tÃ¼phane sayesinde otomatik olarak ayarlanÄ±r. Ä°ki yeni alan eklediÄŸimiz iÃ§in yeni bir `migration` daha gereklidir:

```shell
symfony console make:migration
```

ğŸ‘‰ Bu komut, zaman damgalarÄ±nÄ± iÃ§eren yeni bir `migration` dosyasÄ± oluÅŸturur.

Ve sonra:

```shell
symfony console doctrine:migrations:migrate
```

ğŸ‘‰ Bu komutla yeni `migration`Ä± uygularÄ±z.

## ğŸ§ª Using Factories to Create Dummy Objects / Sahte Nesneler OluÅŸturmak iÃ§in Factory Kullanmak

Ã–nceki derste, bir sÃ¼rÃ¼ sahte veri oluÅŸturmak iÃ§in `Foundry` adÄ±nda harika bir kÃ¼tÃ¼phane kullandÄ±k. Åimdi `StarshipPart` iÃ§in aynÄ±sÄ±nÄ± yapacaÄŸÄ±z. 1. adÄ±m â€“ henÃ¼z yok â€“ bir `factory` oluÅŸturmaktÄ±r:

```shell
symfony console make:factory
```

ğŸ‘‰ Bu komut, belirtilen `entity` iÃ§in bir `factory` sÄ±nÄ±fÄ± oluÅŸturur.

Åuraya gidip bakÄ±n: `src/Factory/StarshipPartFactory.php`. Her alan iÃ§in bazÄ± varsayÄ±lanlar ekledi, ama bunu daha ilginÃ§ hale getirebiliriz. DosyanÄ±n en Ã¼stÃ¼ne bazÄ± Ã¶rnek parÃ§a verilerini iÃ§eren kodu yapÄ±ÅŸtÄ±rÄ±n. AyrÄ±ca `defaults()` fonksiyonundaki `return` ifadesini, bu verileri kullanan bir kodla deÄŸiÅŸtirin.

```php
//src/Factory/StarshipPartFactory.php

// ... lines 1 - 10
final class StarshipPartFactory extends PersistentProxyObjectFactory
{
    private static array $partIdeas = [
        'warp core' => 'looks cool AND zoom',
        'shield generator' => 'in case you run into any Borg',
        'captain\'s chair' => 'just slightly more comfortable than the others',
        'fuzzy dice' => 'obviously',
        'photon torpedoes' => 'for when the fuzzy dice don\'t work',
        'holodeck' => 'parental controls? No way!',
        'Tactical Whoopee Cushion Array' => 'can\'t beat them? Embarrass them!',
        'Temporal Seat Warmers' => 'warm your seat before you sit down',
        'Food Replicator' => 'Earl Grey, hot',
        'Self-Destruct Button Cover' => 'for when you have a cat',
        'Redshirt Dispenser' => 'Instantly replenishes expendable crew members.',
    ];
// ... lines 26 - 44
    protected function defaults(): array|callable
    {
        $randomPartKey = self::faker()->randomKey(self::$partIdeas);
        $randomPart = [$randomPartKey, self::$partIdeas[$randomPartKey]];
        return [
            'name' => $randomPart[0],
            'notes' => $randomPart[1],
            'price' => self::faker()->randomNumber(5),
        ];
    }
// ... lines 56 - 65
}
```

ğŸ‘‰ Bu `factory`, rastgele parÃ§a adÄ±, aÃ§Ä±klama ve fiyat Ã¼reterek sahte `StarshipPart` nesneleri oluÅŸturur.

Son olarak bunu `fixtures` iÃ§inde kullanÄ±n. DosyanÄ±n en altÄ±na gidip 50 rastgele parÃ§a oluÅŸturun:

```php
// src/DataFixtures/AppFixtures.php

// ... lines 1 - 10
class AppFixtures extends Fixture
{
    public function load(ObjectManager $manager): void
    {
// ... lines 15 - 38
        StarshipFactory::createMany(20);
        StarshipPartFactory::createMany(50);
    }
}
````

ğŸ‘‰ Bu `fixture`, 20 `Starship` ve 50 `StarshipPart` nesnesi oluÅŸturur.

Terminale dÃ¶nÃ¼n ve ÅŸu komutu Ã§alÄ±ÅŸtÄ±rÄ±n:

```shell
symfony console doctrine:fixtures:load
```

ğŸ‘‰ Bu komut, tÃ¼m sahte verileri veritabanÄ±na yÃ¼kler.

VeritabanÄ±ndaki yeni parÃ§alarÄ± kontrol etmek iÃ§in:

```shell
symfony console doctrine:query:sql "select * from starship_part";
```

ğŸ‘‰ Bu SQL komutu, `starship_part` tablosundaki tÃ¼m verileri listeler.

Ve sadece birkaÃ§ satÄ±r kodla, veritabanÄ±nda 50 rastgele parÃ§amÄ±z oldu. SÄ±radaki adÄ±m: bu parÃ§alarÄ± ait olduklarÄ± gemilere baÄŸlayarak ilk iliÅŸkimizi oluÅŸturmak â€“ yani `ManyToOne` iliÅŸkisi.
