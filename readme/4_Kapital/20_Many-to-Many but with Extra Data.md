# ğŸ”„ Many-to-Many but with Extra Data / Ekstra Verili Ã‡oktan-Ã‡oÄŸa Ä°liÅŸki

`ManyToMany` iliÅŸkiler, Doctrine'de veritabanÄ±mÄ±zda bir tabloya (`starship_droid`) sahip olup uygulamamÄ±zda karÅŸÄ±lÄ±k gelen bir entity'nin olmadÄ±ÄŸÄ± tek yerdir.

Ama burada bir durum var: Bu birleÅŸtirme tablosuna ekstra sÃ¼tun ekleyemeyiz. Mesela, bir droid'in bir yÄ±ldÄ±z gemisine ne zaman atandÄ±ÄŸÄ±nÄ± takip etmek isteseydik? Bunun iÃ§in bir `assignedAt` sÃ¼tununa ihtiyacÄ±mÄ±z olurdu. Ama bunu ekleyemiyoruz!

`Many-to-Many` Yeterli OlmadÄ±ÄŸÄ±nda
Ã‡Ã¶zÃ¼m, kollarÄ± sÄ±vayÄ±p iÅŸleri daha elle yÃ¶netmeye baÅŸlamaktÄ±r.

ArtÄ±k `many-to-many` iliÅŸkiyi tamamen kullanmayacaÄŸÄ±z. Bunun yerine, birleÅŸtirme tablosunu temsil eden yeni bir entity oluÅŸturacaÄŸÄ±z. Ä°lk olarak, `many-to-many` iliÅŸkiyi geri alÄ±yoruz (sadece property'lerle ilgileniyoruz, metotlarla deÄŸil). `Starship` iÃ§inde, `droids` propertyâ€™sine elveda deyin:


```php
// src/Entity/Starship.php
// ... lines 1 - 15
class Starship
{
// ... lines 18 - 50
    /**
     * @var Collection<int, Droid>
     */
    #[ORM\ManyToMany(targetEntity: Droid::class, inversedBy: 'starships')]
    private Collection $droids;
// ... lines 56 - 227
}
```

ğŸ‘‰ Bu bÃ¶lÃ¼mde, `Starship` entityâ€™sindeki `droids` Ã¶zelliÄŸini kaldÄ±rÄ±yoruz.

Ve `Droid` tarafÄ±nda da, aynÄ± ÅŸekilde `starships` many-to-many propertyâ€™sini kaldÄ±rÄ±yoruz:


```php
// src/Entity/Droid.php
// ... lines 1 - 10
class Droid
{
// ... lines 13 - 23
    /**
     * @var Collection<int, Starship>
     */
    #[ORM\ManyToMany(targetEntity: Starship::class, mappedBy: 'droids')]
    private Collection $starships;
// ... lines 29 - 89
}
```

ğŸ‘‰ Bu bÃ¶lÃ¼mde, `Droid` entityâ€™sindeki `starships` Ã¶zelliÄŸini kaldÄ±rÄ±yoruz.

Her iki entityâ€™de de constructorâ€™Ä± temizleyin.

Terminalinizi aÃ§Ä±p ÅŸu komutu Ã§alÄ±ÅŸtÄ±rÄ±n:

```bash
symfony console doctrine:schema:update --dump-sql
```

ğŸ‘‰ Bu komut, ÅŸu anda migration oluÅŸturacak olsanÄ±z nasÄ±l bir SQL Ã§alÄ±ÅŸacaÄŸÄ±nÄ± gÃ¶sterir.

Bu tam da beklediÄŸimiz gibi: ArtÄ±k `starship_droid` tablosu yok.


## ğŸ§± Creating a New Join Entity / Yeni Bir BirleÅŸtirme (Join) Entityâ€™si OluÅŸturmak

Ama henÃ¼z migrationâ€™Ä± oluÅŸturmayÄ±n! BirleÅŸtirme tablosunu istiyoruz ama ÅŸimdi onu temsil edecek bir entityâ€™ye ihtiyacÄ±mÄ±z var. Åu komutu Ã§alÄ±ÅŸtÄ±rÄ±n:

```bash
symfony console make:entity StarshipDroid
```

ğŸ‘‰ Bu komut yeni bir entity oluÅŸturur. `DroidAssignment` daha uygun bir isim olabilir ama `StarshipDroid` ne yaptÄ±ÄŸÄ±mÄ±zÄ± daha iyi gÃ¶rselleÅŸtirir: AynÄ± veritabanÄ± iliÅŸkisini iki adet `ManyToOne` ile tekrar oluÅŸturmak.

`assignedAt` alanÄ±nÄ± ekleyin ve bu join tablosundan `Starship` ve `Droid`â€™a iliÅŸkiler kuracak iki Ã¶zellik daha ekleyin.

Bunlar `ManyToOne` iliÅŸkiler olacak ve `StarshipDroid`â€™i `Starship` ve `Droid` ile iliÅŸkilendirecek.

## âš¡ The Migration that Does Nothing / HiÃ§bir Åey Yapmayan Migration

Åimdi migrationâ€™Ä± oluÅŸturun:

```bash
symfony console make:migration
```

ğŸ‘‰ Bu komut migration dosyasÄ±nÄ± oluÅŸturur.

Ve kontrol edin. Pek Ã§ok deÄŸiÅŸiklik var gibi gÃ¶rÃ¼nebilir ama dikkatlice bakÄ±n: Sadece foreign key kÄ±sÄ±tlamalarÄ±nÄ± kaldÄ±rÄ±yor, birincil anahtar ekliyor ve foreign keyâ€™i yeniden oluÅŸturuyor:


```php
// migrations/Version20250315183623.php
// ... lines 1 - 12
final class Version20250315183623 extends AbstractMigration
{
// ... lines 15 - 19
    public function up(Schema $schema): void
    {
        // this up() migration is auto-generated, please modify it to your needs
        $this->addSql('ALTER TABLE starship_droid DROP CONSTRAINT FK_1C7FBE889B24DF5');
        $this->addSql('ALTER TABLE starship_droid DROP CONSTRAINT FK_1C7FBE88AB064EF');
        $this->addSql('ALTER TABLE starship_droid DROP CONSTRAINT starship_droid_pkey');
        $this->addSql('ALTER TABLE starship_droid ADD id INT GENERATED BY DEFAULT AS IDENTITY NOT NULL');
        $this->addSql('ALTER TABLE starship_droid ADD assigned_at TIMESTAMP(0) WITHOUT TIME ZONE NOT NULL');
        $this->addSql('ALTER TABLE starship_droid ADD CONSTRAINT FK_1C7FBE889B24DF5 FOREIGN KEY (starship_id) REFERENCES starship (id) NOT DEFERRABLE INITIALLY IMMEDIATE');
        $this->addSql('ALTER TABLE starship_droid ADD CONSTRAINT FK_1C7FBE88AB064EF FOREIGN KEY (droid_id) REFERENCES droid (id) NOT DEFERRABLE INITIALLY IMMEDIATE');
        $this->addSql('ALTER TABLE starship_droid ADD PRIMARY KEY (id)');
    }
// ... lines 32 - 44
}
```

ğŸ‘‰ Bu migration aslÄ±nda veritabanÄ±nda gerÃ§ek bir deÄŸiÅŸiklik yapmaz.

Åimdi ÅŸunu Ã§alÄ±ÅŸtÄ±rÄ±n:

```bash
symfony console doctrine:migrations:migrate
```

ğŸ‘‰ Bu komut migrationâ€™Ä± uygular.
